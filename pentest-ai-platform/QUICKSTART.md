# Pentest AI Platform - Quick Start Guide

**Status**: Week 1 Complete - Authentication System Ready
**Time to Get Running**: 5-10 minutes (if Docker installed)

---

## Prerequisites Check

```bash
# Check Python version (need 3.11+)
python3 --version

# Check Docker (optional but recommended)
docker --version

# Check if ports are free
lsof -i :8000  # FastAPI backend
lsof -i :5432  # PostgreSQL
lsof -i :6379  # Redis
lsof -i :9000  # MinIO
```

---

## Setup (Choose ONE path)

### Path A: With Docker (Recommended)

```bash
cd /Users/annalealayton/PyCharmMiscProject/pentest-ai-platform

# 1. Start infrastructure
docker compose up -d

# 2. Wait for services to be healthy (30 seconds)
docker compose ps

# 3. Setup Python environment
cd backend
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 4. Start backend
python main.py
```

### Path B: Without Docker (Manual PostgreSQL/Redis)

```bash
# 1. Install and start PostgreSQL 16+ locally
# 2. Install and start Redis 7+ locally
# 3. Update backend/.env with your connection strings

cd /Users/annalealayton/PyCharmMiscProject/pentest-ai-platform/backend

# 4. Setup Python environment
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 5. Start backend
python main.py
```

---

## Verify Installation

### Test 1: Health Check

```bash
curl http://localhost:8000/health
```

Expected output:
```json
{
  "status": "healthy",
  "app": "Pentest AI Platform",
  "version": "0.1.0",
  "environment": "development"
}
```

### Test 2: API Documentation

Open in browser: http://localhost:8000/docs

You should see the FastAPI interactive documentation with all authentication endpoints.

---

## Test Authentication Flow

### Manual Testing

#### 1. Register User

```bash
curl -X POST http://localhost:8000/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@example.com",
    "password": "SecurePass123!",
    "full_name": "Admin User",
    "role": "CISO"
  }'
```

#### 2. Login

```bash
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@example.com",
    "password": "SecurePass123!"
  }'
```

Save the `access_token` from the response.

#### 3. Get Current User

```bash
curl http://localhost:8000/api/auth/me \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN_HERE"
```

#### 4. Generate Signing Key

```bash
curl -X POST http://localhost:8000/api/auth/signing-key \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN_HERE"
```

**CRITICAL**: Save the `private_key` from the response. It's only shown once!

### Automated Testing

```bash
cd /Users/annalealayton/PyCharmMiscProject/pentest-ai-platform
./test_auth.sh
```

This script tests:
- âœ… Health check
- âœ… User registration
- âœ… User login
- âœ… JWT authentication
- âœ… RSA key generation
- âœ… Key listing
- âœ… Invalid token rejection

---

## What's Working Now

### âœ… Implemented (Week 1 Complete)

1. **Infrastructure**
   - FastAPI backend with async support
   - PostgreSQL database with 11 models
   - Redis for caching and queues
   - MinIO for evidence storage (S3-compatible)

2. **Authentication**
   - User registration with RBAC (6 roles)
   - JWT token authentication (24-hour expiration)
   - RSA-2048 key pair generation for digital signatures
   - Password hashing with bcrypt
   - Protected endpoints with role-based permissions

3. **Database Models**
   - Users with 6 roles (COORDINATOR, APPROVER, OPERATOR, TEAM_LEAD, CISO, AUDITOR)
   - Projects, Scopes, TestPlans, Actions, Runs
   - Approvals with TTL enforcement
   - Evidence with hash chaining
   - Findings with CVSS scoring
   - Audit logs (append-only)

### ðŸš§ Coming Next (Week 2-8)

- [ ] Project and scope management APIs
- [ ] Dual-signature scope lock
- [ ] Test planning agent (LLM-based)
- [ ] Autonomous execution engine (L0-L1)
- [ ] Approval queue (L2-L3)
- [ ] LangGraph orchestration
- [ ] Scope monitoring (real-time)
- [ ] Findings triage and reporting
- [ ] Frontend UI

---

## Troubleshooting

### Port Already in Use

```bash
# Find process using port 8000
lsof -i :8000

# Kill process
kill -9 <PID>
```

### Database Connection Failed

```bash
# Check if PostgreSQL is running
docker compose ps postgres

# View logs
docker compose logs postgres

# Restart
docker compose restart postgres
```

### Redis Connection Failed

```bash
# Check if Redis is running
docker compose ps redis

# Test connection
redis-cli ping
```

### Import Errors

```bash
# Make sure virtual environment is activated
source venv/bin/activate

# Reinstall dependencies
pip install --upgrade -r requirements.txt
```

---

## Useful Commands

### Development

```bash
# Start backend with auto-reload
cd backend
python main.py

# Start in background
nohup python main.py > server.log 2>&1 &

# View logs
tail -f server.log
```

### Docker

```bash
# View all services
docker compose ps

# View logs
docker compose logs -f

# Restart services
docker compose restart

# Stop services
docker compose down

# Reset everything (CAUTION: deletes data)
docker compose down -v
```

### Database

```bash
# Connect to PostgreSQL
docker compose exec postgres psql -U pentest -d pentest_db

# Useful queries:
\dt                           # List tables
SELECT * FROM users;          # View users
SELECT * FROM audit_log       # View audit log
  ORDER BY timestamp DESC
  LIMIT 10;
```

### Redis

```bash
# Connect to Redis
docker compose exec redis redis-cli

# Useful commands:
KEYS *                        # List all keys
GET approval_queue            # View approval queue
```

---

## API Endpoints Reference

### Authentication
- `POST /api/auth/register` - Register new user
- `POST /api/auth/login` - Login and get JWT token
- `GET /api/auth/me` - Get current user info
- `POST /api/auth/signing-key` - Generate RSA key pair
- `GET /api/auth/signing-keys` - List signing keys

### System
- `GET /health` - Health check
- `GET /` - API info
- `GET /docs` - Interactive API documentation
- `GET /redoc` - Alternative API documentation

---

## Security Notes

### JWT Tokens
- Expiration: 24 hours (configurable in .env)
- Algorithm: HS256
- Secret: Change `JWT_SECRET` in .env for production

### RSA Keys
- Key size: 2048 bits
- Private keys are NEVER stored
- Only shown once during generation
- Store private keys securely (encrypted, offline)

### Passwords
- Minimum length: 8 characters
- Hashed with bcrypt
- Never stored in plain text

---

## Next Steps

### For Developers

1. **Week 2 Tasks**:
   - Implement project CRUD APIs
   - Implement scope CRUD APIs with dual-signature lock
   - Add audit logging service

2. **Week 3 Tasks**:
   - Integrate LLM client (Llama or Claude)
   - Implement test planning agent
   - Add plan generation and approval endpoints

3. **Week 4+ Tasks**:
   - Follow the implementation plan in PROJECT_STATUS.md

### For Testing

1. Register multiple users with different roles
2. Test role-based access control
3. Generate signing keys for each user
4. Use FastAPI /docs to explore all endpoints interactively

---

## Support

- **Documentation**: See README.md and PROJECT_STATUS.md
- **API Reference**: http://localhost:8000/docs
- **Architecture**: Review original delivery documents

**Current Phase**: Week 1 Complete (Authentication & Foundation)
**Next Milestone**: Week 2 (Projects & Scopes)
