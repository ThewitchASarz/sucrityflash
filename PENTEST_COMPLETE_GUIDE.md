# ğŸ›¡ï¸ SecurityFlash - Complete Pentest Workflow Guide

## âœ… System Status

All services are running and operational:

| Service | Port | Status |
|---------|------|--------|
| PostgreSQL | 5432 | âœ… Healthy |
| Redis | 6379 | âœ… Healthy |
| MinIO | 9000-9001 | âœ… Healthy |
| SecurityFlash V1 API | 8000 | âœ… Healthy |
| V2 BFF (Stateless Proxy) | 3001 | âœ… Healthy |
| V2 Frontend (React) | 3000 | Ready to start |

---

## ğŸš€ Step 1: Start the Frontend UI

The V2 Frontend is built with React and ready to run.

### Start the UI:

```bash
cd pentest-ai-platform/frontend
npm start
```

The UI will start on **http://localhost:3000**

### What the UI connects to:
- **API Endpoint**: http://localhost:3001/api/v1 (V2 BFF)
- **V2 BFF proxies all requests to V1 API** (stateless proxy)

---

## ğŸ”§ Step 2: Conduct a Pentest (API Method)

You can test the full workflow via API calls while the UI is being developed.

### Complete Workflow:

```bash
#!/bin/bash
# SecurityFlash Pentest Workflow

BFF_URL="http://localhost:3001/api/v1"

# 1. Create Project
echo "Creating project..."
PROJECT=$(curl -s -X POST "$BFF_URL/projects" \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Example.com Pentest",
    "customer_id": "customer-123",
    "created_by": "security-team",
    "rules_of_engagement": "Reconnaissance only on example.com"
  }')

PROJECT_ID=$(echo "$PROJECT" | python3 -c "import sys, json; print(json.load(sys.stdin)['id'])")
echo "âœ… Project ID: $PROJECT_ID"

# 2. Create Scope
echo "Creating scope..."
SCOPE=$(curl -s -X POST "$BFF_URL/projects/$PROJECT_ID/scopes" \
  -H "Content-Type: application/json" \
  -d '{
    "scope_type": "web_app",
    "targets": [
      {"type": "domain", "value": "example.com", "description": "Target domain"}
    ],
    "excluded_targets": [],
    "attack_vectors_allowed": ["reconnaissance", "port_scanning"],
    "attack_vectors_prohibited": ["sql_injection", "xss"],
    "approved_tools": ["nmap", "curl", "dig"]
  }')

SCOPE_ID=$(echo "$SCOPE" | python3 -c "import sys, json; print(json.load(sys.stdin)['id'])")
echo "âœ… Scope ID: $SCOPE_ID"

# 3. Create Run
echo "Creating run..."
RUN=$(curl -s -X POST "$BFF_URL/projects/$PROJECT_ID/runs" \
  -H "Content-Type: application/json" \
  -d "{
    \"scope_id\": \"$SCOPE_ID\",
    \"policy_version\": \"1.0.0\",
    \"max_iterations\": 50,
    \"created_by\": \"security-team\"
  }")

RUN_ID=$(echo "$RUN" | python3 -c "import sys, json; print(json.load(sys.stdin)['id'])")
echo "âœ… Run ID: $RUN_ID"

# 4. View Project
echo "Viewing project..."
curl -s "$BFF_URL/projects/$PROJECT_ID" | python3 -m json.tool

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "âœ… Pentest Created Successfully!"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "Project ID: $PROJECT_ID"
echo "Scope ID:   $SCOPE_ID"
echo "Run ID:     $RUN_ID"
echo ""
echo "Access via:"
echo "  V2 BFF: $BFF_URL/projects/$PROJECT_ID"
echo "  V1 API: http://localhost:8000/api/v1/projects/$PROJECT_ID"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
```

Save this as `run_pentest.sh`, make it executable, and run it:

```bash
chmod +x run_pentest.sh
./run_pentest.sh
```

---

## ğŸ“Š Step 3: View Pentest Data

### Via API:

```bash
# List all projects
curl -s http://localhost:3001/api/v1/projects | python3 -m json.tool

# Get specific project
curl -s http://localhost:3001/api/v1/projects/{PROJECT_ID} | python3 -m json.tool

# List scopes for a project
curl -s http://localhost:3001/api/v1/projects/{PROJECT_ID}/scopes | python3 -m json.tool

# List runs for a project
curl -s http://localhost:3001/api/v1/projects/{PROJECT_ID}/runs | python3 -m json.tool
```

### Via UI:

Once the frontend is running on http://localhost:3000, you can:

1. **View Projects** - See all pentests
2. **Create New Project** - Start a new security assessment
3. **Define Scope** - Specify targets and allowed actions
4. **Start Run** - Execute the pentest
5. **Monitor Progress** - Watch real-time results
6. **View Evidence** - See collected data
7. **Generate Reports** - Export findings

---

## ğŸ¯ Step 4: Understanding the Architecture

### Data Flow:

```
User/UI (Port 3000)
    â†“
V2 BFF - Stateless Proxy (Port 3001)
    â†“ (proxies all requests)
SecurityFlash V1 API (Port 8000)
    â†“
PostgreSQL Database (Port 5432)
```

### Key Points:

- **V2 BFF has NO database** - it only proxies requests
- **V1 is the single source of truth** - all data lives here
- **V2 BFF is stateless** - no sessions, no cache, pure proxy
- **All business logic in V1** - approvals, policy, execution

---

## ğŸ” Step 5: API Endpoints Reference

### Projects
- `POST /api/v1/projects` - Create project
- `GET /api/v1/projects` - List projects
- `GET /api/v1/projects/{id}` - Get project
- `PUT /api/v1/projects/{id}` - Update project

### Scopes
- `POST /api/v1/projects/{project_id}/scopes` - Create scope
- `GET /api/v1/projects/{project_id}/scopes` - List scopes
- `GET /api/v1/projects/{project_id}/scopes/{id}` - Get scope

### Runs
- `POST /api/v1/projects/{project_id}/runs` - Create run
- `GET /api/v1/projects/{project_id}/runs` - List runs
- `GET /api/v1/projects/{project_id}/runs/{id}` - Get run
- `POST /api/v1/runs/{run_id}/start` - Start execution

### Evidence
- `GET /api/v1/runs/{run_id}/evidence` - List evidence
- `GET /api/v1/runs/{run_id}/evidence/{id}` - Get evidence

### Approvals
- `GET /api/v1/runs/{run_id}/approvals/pending` - Get pending approvals
- `POST /api/v1/runs/{run_id}/approvals/{action_id}/approve` - Approve action

---

## ğŸ§ª Step 6: Testing Commands

### Health Checks:

```bash
# V1 Health
curl http://localhost:8000/health

# V2 BFF Health
curl http://localhost:3001/health

# Database Connection
docker-compose exec postgres psql -U postgres -d securityflash -c "SELECT COUNT(*) FROM projects;"
```

### Quick Test:

```bash
# Create a test project
curl -X POST http://localhost:3001/api/v1/projects \
  -H "Content-Type: application/json" \
  -d '{"name":"Test","customer_id":"test","created_by":"test"}'

# List all projects
curl http://localhost:3001/api/v1/projects
```

---

## ğŸ“ Step 7: Example Pentest Scenario

### Scenario: Security Assessment of example.com

**Target**: example.com (safe public test domain)

**Scope**:
- Reconnaissance only
- Non-intrusive scanning
- Information gathering

**Tools Allowed**:
- nmap (port scanning)
- curl (HTTP requests)
- dig/nslookup (DNS queries)
- whois (domain info)

**Prohibited Actions**:
- SQL injection
- XSS attacks
- DoS/DDoS
- Exploitation

**Expected Workflow**:

1. **Create Project** - "Example.com Security Assessment"
2. **Define Scope** - example.com domain, IP 93.184.216.34
3. **Set Rules** - Recon only, specific tools allowed
4. **Create Run** - Initiate pentest with 50 max iterations
5. **Agent Executes** - AI agent proposes actions
6. **Approval Required** - High-risk actions need approval
7. **Evidence Collected** - All tool outputs stored immutably
8. **Generate Report** - Final security assessment

---

## ğŸš¦ Troubleshooting

### Services Not Starting:

```bash
# Check all services
docker-compose ps

# Restart all services
docker-compose restart

# View logs
docker-compose logs -f
```

### Database Issues:

```bash
# Reinitialize database
docker-compose exec securityflash-api python init_db.py

# Check tables
docker-compose exec postgres psql -U postgres -d securityflash -c "\dt"
```

### Frontend Issues:

```bash
cd pentest-ai-platform/frontend

# Install dependencies
npm install

# Start dev server
npm start

# Check for errors
npm run build
```

---

## ğŸ‰ You're Ready!

**Everything is configured and working:**

âœ… V1 API operational
âœ… V2 BFF proxying correctly
âœ… Database initialized
âœ… All services healthy
âœ… API endpoints tested

**Start the UI and begin your pentest!**

```bash
cd pentest-ai-platform/frontend
npm start
```

Then open: **http://localhost:3000**

---

## ğŸ“ Quick Reference

| What | Where |
|------|-------|
| Frontend UI | http://localhost:3000 |
| V2 BFF API | http://localhost:3001 |
| V1 API | http://localhost:8000 |
| MinIO Console | http://localhost:9001 |
| PostgreSQL | localhost:5432 |
| Redis | localhost:6379 |

**Ready to conduct pentests! ğŸ›¡ï¸**
